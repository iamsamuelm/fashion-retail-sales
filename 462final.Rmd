---
title: "INST462 Final Project: Retail Customer Segments and Spending Insights"
output: html_document
date: "2025-05-10"
---

### Research Question
- What key factors influence total customer spending, and how do customer segments differ in their purchase behavior and satisfaction?

### Data Source
- Dataset: Kaggle - Retail Analysis Large Dataset

- Dataset link: https://www.kaggle.com/datasets/sahilprajapati143/retail-analysis-large-dataset/data


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(ggpubr)
library(rstatix)
library(scales)
```

### Load and Preview

```{r}
raw_data <- read.csv("new_retail_data.csv") 
raw_data <- head(raw_data, 500)
head(raw_data)
```

### Cleaning

```{r}
cleaned_data <-  raw_data %>%
  filter(!is.na(Ratings) & Ratings != "" &
           !is.na(Product_Category) & Product_Category != "" &
           !is.na(Gender) & Gender != "" &
           !is.na(Total_Amount) & Total_Amount != "" &
           !is.na(Customer_Segment) & Customer_Segment != "" &
           !is.na(Total_Purchases) & Total_Purchases != "" &
           !is.na(Age) & Age != "" &
           !is.na(Year) & Year != "")

# write.csv(cleaned_data, "cleaned_retail_data.csv", row.names = FALSE)

data1 <- read.csv("cleaned_retail_data.csv")

```

### Age group related insights

**Total Spending by Age Group**

```{r}
data1 <- data1 %>%
  mutate(Age_Group = case_when(
    Age < 30 ~ "Young",
    Age >= 30 & Age < 50 ~ "Middle-aged",
    Age >= 50 ~ "Older"
  ))

data1 %>%
  group_by(Age_Group) %>%
  summarise(total_spending = sum(Total_Amount)) %>%
  ggplot(aes(x = reorder(Age_Group, -total_spending), y = total_spending, fill = Age_Group)) +
  geom_col() +
  geom_text(aes(label = comma(total_spending)), vjust = -0.5, size = 3.5) +
  labs(title = "Total Spending by Age Group", y = "Total Amount (USD)", x = "Age Group") +
  scale_y_continuous(labels = comma) +
  theme_minimal()

```

**Product Preferences by Age Group**

```{r}
age_product <- data1 %>%
  group_by(Age_Group, Product_Category) %>%
  summarise(count = n(), .groups = 'drop')

ggplot(age_product, aes(x = Product_Category, y = count, fill = Age_Group)) +
  geom_col(position = "dodge") +
  geom_text(aes(label = count), position = position_dodge(width = 0.9), vjust = -0.5, size = 3.3) +
  labs(title = "Product Preferences by Age Group", x = "Product Category", y = "Number of Purchases") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

```

### Brand related insights

**Total Sales by Brand**

```{r}
brand_sales <- data1 %>%
  group_by(Product_Brand) %>%
  summarise(total_sales = sum(Total_Amount), .groups = "drop")

ggplot(brand_sales, aes(x = reorder(Product_Brand, -total_sales), y = total_sales)) +
  geom_col(fill = "steelblue") +
  geom_text(aes(label = comma(total_sales)), hjust = -0.1, size = 3.5) +
  labs(title = "Total Sales by Brand",
       x = "Product Brand",
       y = "Total Sales") +
  scale_y_continuous(labels = comma) +
  theme_minimal() +
  coord_flip() 

```

**Total Spending by Product Brand and Type**

```{r}
brand_type_spending <- data1 %>%
  group_by(Product_Brand, Product_Type) %>%
  summarise(total_spending = sum(Total_Amount), .groups = "drop")

ggplot(brand_type_spending, aes(x = Product_Type, y = total_spending, fill = Product_Brand)) +
  geom_col(position = position_dodge(width = 0.9), width = 0.7) +
  labs(title = "Total Spending by Product Brand and Type", x = "Product Type", y = "Total Spending") +
  scale_y_continuous(labels = comma) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10))

```

**Average Rating by Product Brand in Electronics**

```{r}
electronics_ratings <- data1 %>%
  filter(Product_Category == "Electronics") %>%
  group_by(Product_Brand) %>%
  summarise(avg_rating = mean(Ratings), .groups = "drop")

ggplot(electronics_ratings, aes(x = reorder(Product_Brand, avg_rating), y = avg_rating, fill = Product_Brand)) +
  geom_col() +
  geom_text(aes(label = round(avg_rating, 1)), vjust = -0.5, size = 3.5) +
  labs(title = "Average Rating by Product Brand in Electronics",
       x = "Product Brand",
       y = "Average Rating") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0))

```

### Gender related insights

**Total Spending by Gender**

```{r}
gender_total <- data1 %>%
  group_by(Gender) %>%
  summarise(total_spend = sum(Total_Amount))

ggplot(gender_total, aes(x = Gender, y = total_spend, fill = Gender)) +
  geom_bar(stat = "identity") +
  geom_text(aes(label = comma(total_spend)), vjust = -0.5, size = 3.5) +
  labs(title = "Total Spending by Gender", y = "Total Amount") +
  theme_minimal()

```

**Total Spending by Gender and Product Category**
```{r}
gender_category_spend <- data1 %>%
  group_by(Gender, Product_Category) %>%
  summarise(total_amount = sum(Total_Amount), .groups = "drop")


ggplot(gender_category_spend, aes(x = Product_Category, y = total_amount, fill = Gender)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_text(aes(label = comma(total_amount)), position = position_dodge(width = 0.9), vjust = -0.5, size = 3) +
  labs(title = "Total Spending by Gender and Product Category",
       x = "Product Category",
       y = "Total Amount") +
  theme_minimal()

```

**Ratings by Gender**

```{r}
ggplot(data1, aes(x = Gender, y = Ratings, fill = Gender)) +
  geom_boxplot() +
  labs(title = "Ratings by Gender", x = "Gender", y = "Customer Rating") +
  theme_minimal()

```

### income related insights

**Total Spending by Income Level**

```{r}
income_spending <- data1 %>%
  group_by(Income) %>%
  summarise(total_spending = sum(Total_Amount))

ggplot(income_spending, aes(x = Income, y = total_spending, fill = Income)) +
  geom_col(fill = "steelblue") +
  geom_text(aes(label = comma(total_spending)), vjust = -0.5, size = 3.5) +
  labs(title = "Total Spending by Income Level", x = "Income Level", y = "Total Amount") +
  scale_y_continuous(labels = comma) +
  theme_minimal()

```

**Product Preferences by Income Level**

```{r}
income_product <- data1 %>%
  group_by(Income, Product_Category) %>%
  summarise(purchase_count = n(), .groups = "drop")

ggplot(income_product, aes(x = Product_Category, y = purchase_count, fill = Income)) +
  geom_col(position = "dodge") +
  geom_text(aes(label = purchase_count), position = position_dodge(width = 0.9), vjust = -0.5, size = 3) +
  labs(title = "Product Preferences by Income Level", y = "Number of Purchases") +
  theme_minimal() 

```

**Customer Segment by Income Level**

```{r}
income_segment <- data1 %>%
  group_by(Income, Customer_Segment) %>%
  summarise(count = n(), .groups = "drop")

ggplot(income_segment, aes(x = Income, y = count, fill = Customer_Segment)) +
  geom_col(position = "dodge") +
  geom_text(aes(label = count), position = position_dodge(width = 0.9), vjust = -0.5, size = 3.5) +
  labs(title = "Customer Segment by Income Level", y = "Number of Customers") +
  theme_minimal()

```
